# 父島事務所 日報システム セットアップガイド

Google フォーム + Slack 連携による日報入力・自動通知システム

---

## 📋 システム概要

```
┌─────────────────┐
│ スマホでフォーム入力 │
│ （Google フォーム）  │
└────────┬────────┘
         ↓
┌─────────────────┐
│ 回答をスプレッドシート │
│ に自動記録          │
└────────┬────────┘
         ↓ Apps Script（自動実行）
┌─────────────────┐
│ Slack チャンネルに   │
│ 自動投稿            │
└─────────────────┘
```

### 現在の構成

| 項目 | 名称・URL |
|------|----------|
| フォーム | 父島事務所 日報（仮）v2 |
| スプレッドシート | 父島事務所 日報（仮）v2（回答） |
| Slackチャンネル | #working_journal |
| スクリプト | slack_notification.gs (v5) |

---

## 📱 日報の入力方法（現場作業員向け）

### 1. フォームを開く
- Slackチャンネルのブックマークから「📋 日報入力」をクリック
- またはスマホのホーム画面のショートカットから開く

### 2. 必須項目を入力
- ■作業日、■事業名、■作業員、■作業人数
- ■傭船、■作業場所（島）、■作業場所（記番）、■作業内容

### 3. 任意項目を入力
- ■天候、■上陸箇所、■希少種確認、■ヒヤリハット
- ■特記事項、■引継ぎ事項
- ■潮位、■潮まわり、■波向、■波高、■風向、■風速
- ■写真URL

### 4. 送信
「送信」ボタンをクリック → Slackに自動投稿されます

---

## 🔧 管理者向け：システム設定手順

### Step 1：Slack Incoming Webhook の設定

1. [Slack API](https://api.slack.com/apps) にアクセス
2. 「Create New App」→「From scratch」
3. App Name：`日報Bot`、ワークスペースを選択
4. 左メニュー「Incoming Webhooks」→ 右上トグルを「On」
5. 「Add New Webhook to Workspace」→ チャンネル選択
6. 表示された Webhook URL をコピー

### Step 2：フォーム自動生成（新規作成の場合）

1. [Google Apps Script](https://script.google.com) にアクセス
2. 「新しいプロジェクト」を作成
3. `scripts/create_form.gs` の内容を貼り付け
4. `createDailyReportForm` を選択して実行
5. 認証を許可
6. ログに表示されるURLを確認

### Step 3：Slack通知スクリプトの設定

⚠️ **重要：スプレッドシート側で設定してください（フォーム側ではありません）**

1. スプレッドシート「父島事務所 日報（仮）v2（回答）」を開く
2. メニュー「**拡張機能**」→「**Apps Script**」
3. `scripts/slack_notification.gs` の内容を貼り付け
4. `SLACK_WEBHOOK_URL` を Step 1 で取得したURLに置き換え
5. 保存（Ctrl+S）

### Step 4：トリガー設定

1. Apps Script 左メニューの ⏰（トリガー）をクリック
2. 「トリガーを追加」

| 項目 | 設定値 |
|------|--------|
| 実行する関数 | `onFormSubmit` |
| イベントのソース | **スプレッドシートから** ← 重要！ |
| イベントの種類 | **フォーム送信時** |

3. 「保存」→ 認証を許可

---

## 📁 ファイル一覧

| ファイル | 用途 |
|---------|------|
| README.md | このファイル |
| scripts/create_form.gs | フォーム自動生成スクリプト |
| scripts/slack_notification.gs | Slack通知スクリプト（v5） |
| docs/form_items.csv | フォーム項目一覧 |
| docs/TROUBLESHOOTING.md | トラブルシューティング詳細 |

---

## 📅 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2024-12-13 | v1 | 初期版作成（8項目） |
| 2024-12-13 | v2 | トリガー設定場所の問題を修正 |
| 2024-12-13 | v3 | 項目追加（21項目対応） |
| 2024-12-13 | v4 | 引継ぎ事項を有無・内容に分離（23項目） |
| 2024-12-13 | v5 | チェックボックス項目を常に表示 |

---

## ライセンス

MIT License

---

作成日：2024-12-13
