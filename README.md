# 父島事務所 日報システム

Google フォーム + Slack 連携による野外作業日報の入力・共有システム

---

## 🎯 このシステムでできること

```
┌─────────────────────────────────────────────────────────┐
│  【現場】                                                │
│    📱 Slackに写真・メモをリアルタイム投稿                  │
│    📝 作業終了後にフォームで日報入力                       │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│  【自動処理】                                             │
│    📊 スプレッドシートに回答を自動記録                     │
│    💬 Slackチャンネルに日報を自動投稿                      │
└─────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────┐
│  【事務所・関係者】                                        │
│    👀 Slackで現場状況をリアルタイム確認                    │
│    📈 スプレッドシートで過去データの検索・集計              │
└─────────────────────────────────────────────────────────┘
```

### メリット

| 従来の方法 | このシステム |
|-----------|-------------|
| 帰港後にPCで日報作成 | 現場でスマホから入力完了 |
| 写真は別途メールで送信 | Slackに直接投稿＆URLをフォームに記載 |
| 日報がバラバラに保存 | スプレッドシートに自動集約 |
| 共有に時間がかかる | Slackでリアルタイム共有 |

---

## 📱 日報作成の流れ（現場作業員向け）

### 全体の流れ

```
出港前          作業中              作業終了後
  │               │                    │
  ▼               ▼                    ▼
Slackで        写真・メモを           フォームで
「出発」報告    Slackに投稿           日報を入力
                  │                    │
                  ▼                    ▼
              リアルタイムで         自動でSlackに
              事務所と共有           日報が投稿される
```

---

### Step 1：作業中 - Slackに写真・状況を投稿

**なぜSlackに投稿するのか？**
- 事務所がリアルタイムで現場状況を把握できる
- 緊急時の情報共有が迅速になる
- 写真をGoogle Driveにアップロードする手間が省ける

**投稿のタイミング（推奨）**

| タイミング | 投稿内容の例 |
|-----------|-------------|
| 出港時 | 「兄島Cラインに向けて出発。天候晴れ、波1m」 |
| 上陸時 | 上陸地点の写真 |
| 作業中 | 作業状況の写真、希少種発見時の写真 |
| 特記事項発生時 | ヒヤリハット、機材トラブル、天候急変など |
| 帰港時 | 「帰港しました」 |

**Slackへの投稿方法**

1. Slackアプリを開く
2. `#working_journal` チャンネルを選択
3. メッセージ入力欄の 📎（クリップ）アイコンをタップ
4. 「写真ライブラリ」または「カメラ」を選択
5. 写真を選んで、コメントを追加して送信

**投稿例**
```
🏝️ 兄島Cライン上陸
西海岸から上陸、波穏やか
[写真]
```

```
🦎 希少種確認
オガサワラトカゲ 成体1匹
Cライン中腹の岩場付近
[写真]
```

```
⚠️ 注意箇所
南斜面の足場が不安定
ロープ設置を推奨
[写真]
```

---

### Step 2：作業終了後 - フォームで日報を入力

**いつ入力するか？**
- 帰港後、または船上で電波が入る場所で入力
- 記憶が新しいうちに入力するのがベスト

**フォームの開き方**

| 方法 | 手順 |
|------|------|
| Slackから | `#working_journal` のブックマーク「📋 日報入力」をタップ |
| ホーム画面から | ショートカットアイコンをタップ |
| 直接URL | フォームの公開URLを入力 |

**入力のコツ**

1. **必須項目を先に埋める**（8項目）
   - ■作業日、■事業名、■作業員、■作業人数
   - ■傭船、■作業場所（島）、■作業場所（記番）、■作業内容

2. **チェックボックスは必ず選択**
   - 希少種確認、ヒヤリハット → 「なし」でも選択する
   - 選択しないと「未選択」と表示され、確認漏れと区別できない

3. **写真URLの貼り方**
   - Slackに投稿した写真は、日報フォームの「■写真URL」欄に貼らなくてOK
   - Google Driveに別途アップロードした写真がある場合のみ、共有リンクを貼る

---

### Step 3：自動でSlackに日報が投稿される

フォーム送信後、数秒で `#working_journal` に日報が自動投稿されます。

**投稿される内容**
```
📋 日報 2024/12/13 (金)
━━━━━━━━━━━━━━
📍 作業場所：兄島 Cライン
🏝️ 上陸箇所：西海岸
📋 事業名：請負
👷 作業員：新妻, 上村, 高岡
👥 作業人数：3名
🚤 傭船：なし
🌤️ 天候：晴れ
📝 作業内容：ギンネム伐採 約50本
🦎 希少種確認：なし
🚨 ヒヤリハット：なし
➡️ 引継ぎ：あり
　　北側から継続

🌊 海況・気象
　潮位：中潮（上潮）
　波：北東 1.5m
　風：北 5m/s
━━━━━━━━━━━━━━
```

**自動投稿のメリット**
- 入力内容の確認ができる（間違いに気づいたら再送信）
- 事務所・関係者への共有が同時に完了
- Slackで検索すれば過去の日報を確認できる

---

## 💬 Slackチャンネルの使い方

### チャンネル `#working_journal` の役割

このチャンネルは**現場と事務所をつなぐメインの連絡手段**です。

| 用途 | 説明 |
|------|------|
| 📷 現場写真の共有 | 作業状況、希少種、注意箇所などを写真で報告 |
| 📋 日報の自動投稿 | フォーム送信後に自動で投稿される |
| 💬 コメント・質問 | 日報や写真へのフィードバック、確認事項 |
| 🚨 緊急連絡 | 天候急変、事故、機材トラブルなど |

### 推奨される運用ルール

1. **現場からの投稿**
   - 出港時・帰港時の報告
   - 作業中の写真・メモ（適宜）
   - 希少種確認時は必ず写真付きで投稿
   - ヒヤリハット発生時は即時報告

2. **事務所からの対応**
   - 現場投稿への👍リアクションで「確認した」を伝える
   - 質問・確認事項はスレッドで返信
   - 緊急時は電話も併用

3. **日報投稿後**
   - 内容に問題なければ👍リアクション
   - 修正が必要な場合はスレッドでコメント

### ブックマークの設定

チャンネル上部のブックマークバーに以下を追加しておくと便利です：

| ブックマーク名 | URL |
|---------------|-----|
| 📋 日報入力 | フォームの公開URL |
| 📊 回答一覧 | スプレッドシートのURL |
| 🌊 海況予報 | 気象庁など |

**設定方法**
1. チャンネル上部の「ブックマークを追加」をクリック
2. 名前とURLを入力して保存

---

## 📝 フォーム入力ガイド

### 必須項目（8項目）

| 項目 | 形式 | 入力のポイント |
|------|------|---------------|
| ■作業日 | 日付 | カレンダーから選択 |
| ■事業名 | チェックボックス | 複数選択可（請負＋委託など） |
| ■作業員 | チェックボックス | 参加者全員にチェック |
| ■作業人数 | プルダウン | 作業員の合計人数 |
| ■傭船 | チェックボックス | 「あり」または「なし」 |
| ■作業場所（島） | プルダウン | 父島/兄島/弟島/孫島 |
| ■作業場所（記番） | 記述式 | 例：カ-12、Cライン |
| ■作業内容 | 記述式 | 1行で簡潔に |

### 任意項目（確認系）

**⚠️ 重要：以下の項目は「なし」でも必ず選択してください**

| 項目 | 選択肢 | 備考 |
|------|--------|------|
| ■希少種確認 | あり / なし / その他 | 「その他」選択時は種名を記入 |
| ■ヒヤリハット | あり / なし / その他 | 「あり」の場合は特記事項に詳細を |
| ■引継ぎ事項の有無 | あり / なし / その他 | 「あり」の場合は内容欄に記入 |

### 任意項目（海況・気象）

| 項目 | 形式 | 入力例 |
|------|------|--------|
| ■天候 | チェックボックス | 晴れ、曇り、雨 |
| ■潮位 | プルダウン | 大潮/中潮/小潮/長潮/若潮 |
| ■潮まわり | プルダウン | 上潮/下潮 |
| ■波向 | プルダウン | 16方位から選択 |
| ■波高 | 記述式 | 数値のみ（例：1.5） |
| ■風向 | プルダウン | 16方位から選択 |
| ■風速 | 記述式 | 数値のみ（例：5） |

### 任意項目（その他）

| 項目 | 形式 | 用途 |
|------|------|------|
| ■上陸箇所 | 記述式 | 上陸した場所の名称 |
| ■特記事項 | 段落 | 詳細な報告、注意事項など |
| ■引継ぎ事項の内容 | 段落 | 翌日以降への引継ぎ |
| ■写真URL | 記述式 | Google Drive共有リンク |

---

## 📷 写真の管理について

### 方法1：Slackに直接投稿（推奨）

**メリット**
- その場ですぐ共有できる
- スマホの操作だけで完結
- 事務所がリアルタイムで確認できる

**デメリット**
- Slackの無料プランでは90日で消える可能性
- 後からの検索がやや難しい

### 方法2：Google Driveにアップロード

**メリット**
- 永続的に保存される
- フォルダで整理できる
- 日報フォームにURLを記載できる

**デメリット**
- アップロードの手間がかかる
- 共有リンクの取得が必要

### 推奨運用

```
【作業中】
  Slackに写真を投稿（リアルタイム共有優先）
      ↓
【帰港後】
  重要な写真はGoogle Driveにも保存
  （希少種、ヒヤリハット、記録として残すべきもの）
      ↓
【日報入力時】
  Google DriveのURLがあれば、フォームの「■写真URL」に記載
  （なければ空欄でOK - Slackに投稿済みなので）
```

---

## 🔧 管理者向け：システム設定手順

### 前提条件

- Googleアカウント（組織のG Suiteまたは個人Gmail）
- Slackワークスペースの管理者権限

### Step 1：Slack Incoming Webhook の設定

1. [Slack API](https://api.slack.com/apps) にアクセス
2. 「Create New App」→「From scratch」
3. App Name：`日報Bot`、ワークスペースを選択
4. 左メニュー「Incoming Webhooks」→ 右上トグルを「On」
5. 「Add New Webhook to Workspace」→ `#working_journal` を選択
6. 表示された Webhook URL をコピー

⚠️ **Webhook URL は秘密情報です。公開しないでください。**

### Step 2：フォームの作成

**方法A：スクリプトで自動生成（推奨）**

1. [Google Apps Script](https://script.google.com) にアクセス
2. 「新しいプロジェクト」を作成
3. `create_form.gs` の内容を貼り付けて保存
4. `createDailyReportForm` を選択して実行
5. 認証を許可
6. ログに表示されるURLを確認

**方法B：手動で作成**

Google フォームで新規作成し、`form_items.csv` を参考に項目を追加

### Step 3：Slack通知スクリプトの設定

⚠️ **重要：スプレッドシート側で設定してください（フォーム側ではありません）**

1. 作成されたスプレッドシートを開く
2. メニュー「**拡張機能**」→「**Apps Script**」
3. `slack_notification.gs` の内容を貼り付け
4. 3行目の `SLACK_WEBHOOK_URL` を Step 1 で取得したURLに置き換え
   ```javascript
   const SLACK_WEBHOOK_URL = "https://hooks.slack.com/services/XXXXX/XXXXX/XXXXX";
   ```
5. 保存（Ctrl+S）

### Step 4：トリガー設定

1. Apps Script 左メニューの ⏰（トリガー）をクリック
2. 「トリガーを追加」
3. 以下のように設定：

| 項目 | 設定値 |
|------|--------|
| 実行する関数 | `onFormSubmit` |
| イベントのソース | **スプレッドシートから** |
| イベントの種類 | **フォーム送信時** |

4. 「保存」→ 認証を許可

### Step 5：動作テスト

1. フォームの公開URLを開く
2. テストデータを入力して送信
3. `#working_journal` に投稿されることを確認
4. スプレッドシートに回答が記録されていることを確認

### Step 6：Slackブックマークの設定

1. `#working_journal` チャンネルを開く
2. チャンネル名の下のブックマークバーで「ブックマークを追加」
3. 以下を追加：
   - 📋 日報入力：フォームの公開URL
   - 📊 回答一覧：スプレッドシートのURL

---

## ⚠️ トラブルシューティング

### Slackに投稿されない

1. **Webhook URLを確認**
   - スクリプト内のURLが正しいか
   - URLの前後に余分な空白がないか

2. **トリガーを確認**
   - Apps Script → ⏰ トリガー → 設定されているか
   - イベントソースが「スプレッドシートから」になっているか

3. **実行ログを確認**
   - Apps Script → 実行数 → エラーがないか

### エラー：Cannot read properties of undefined

**原因**：フォーム側でスクリプトを設定している

**解決**：
1. フォーム側のトリガーを削除
2. **スプレッドシート側**でスクリプトとトリガーを設定

### フォームが開けない

**解決**：フォーム編集画面の右上「送信」→ リンクをコピー

### 認証警告が表示される

「Google hasn't verified this app」という警告は正常です。
「Advanced」→「Go to [プロジェクト名] (unsafe)」→「Allow」で進めてください。

---

## 📁 ファイル一覧

| ファイル | 用途 |
|---------|------|
| README.md | このファイル（セットアップガイド） |
| create_form.gs | フォーム自動生成スクリプト |
| slack_notification.gs | Slack通知スクリプト |
| form_items.csv | フォーム項目一覧（Excel用） |
| TROUBLESHOOTING.md | トラブルシューティング詳細 |

---

## 📅 更新履歴

| 日付 | バージョン | 内容 |
|------|-----------|------|
| 2024-12-13 | v1.0 | 初期版（8項目） |
| 2024-12-13 | v2.0 | 項目追加（23項目対応） |
| 2024-12-13 | v3.0 | チェックボックス常時表示、運用ガイド追加 |

---

## 📞 問い合わせ

システムに問題がある場合は、Slackの `#working_journal` チャンネルで報告してください。